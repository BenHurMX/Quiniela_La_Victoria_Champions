<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiniela La Victoria - Champions</title>

    <!-- Fuente Bebas Neue de Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet" />

    <!-- Tu hoja de estilos -->
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <div class="container">
        <img src="logos/logo.png" class="logo" alt="Logo Quiniela" />
        <h1>Semifinales Champions League 2025</h1>

        <!-- Formulario -->
        <div class="form">
            <input type="text" placeholder="Nombre de usuario" id="nombre" required />
            <input type="text" placeholder="Número de WhatsApp" id="whatsapp" required />
            <button class="button" onclick="enviarQuiniela()">ENVIAR QUINIELA</button>
        </div>
        <button class="button" onclick="verMiQuiniela()">Ver mi Quiniela</button>

        <div id="mi-quiniela" style="display: none;">
            <h2>Tu Quiniela</h2>
            <ul id="lista-mi-quiniela"></ul>
        </div>

        <hr/>

        <div id="tabla-general">
            <h2>Tabla de Participantes</h2>
            <ul id="lista-participantes"></ul>
        </div>

        <a href="resultados.html" class="button" style="margin-top: 20px;">Ver Resultados Detallados</a>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC9CKF9N6eBcxTrPTP2LE7RF-ep657dohs",
            authDomain: "quiniela-la-victoria-46bc3.firebaseapp.com",
            projectId: "quiniela-la-victoria-46bc3",
            storageBucket: "quiniela-la-victoria-46bc3.appspot.com",
            messagingSenderId: "13863862689",
            appId: "1:13863862689:web:d026cefdefbbcd7c46cbe0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.enviarQuiniela = async function () {
            const nombre = document.getElementById("nombre").value;
            const whatsapp = document.getElementById("whatsapp").value;

            const partidos = document.querySelectorAll('.partido');
            const resultados = [];

            partidos.forEach(partido => {
                const marcadores = partido.querySelectorAll('.marcador');
                resultados.push({
                    local: parseInt(marcadores[0].value) || 0,
                    visitante: parseInt(marcadores[1].value) || 0
                });
            });

            try {
                await addDoc(collection(db, "participantes"), {
                    nombre,
                    whatsapp,
                    resultados,
                    puntos: 0
                });

                alert("¡Quiniela enviada con éxito!");
                document.getElementById("nombre").value = "";
                document.getElementById("whatsapp").value = "";
                document.querySelectorAll('.marcador').forEach(marcador => marcador.value = "");
            } catch (error) {
                console.error("Error al enviar la quiniela:", error);
                alert("Error al enviar la quiniela. Por favor, inténtalo de nuevo.");
            }
        };

        window.verMiQuiniela = async function () {
            const nombre = document.getElementById("nombre").value;
            if (!nombre) {
                alert("Por favor escribe tu nombre");
                return;
            }

            const lista = document.getElementById("lista-mi-quiniela");
            lista.innerHTML = "";

            const q = query(collection(db, "participantes"), where("nombre", "==", nombre));
            const querySnapshot = await getDocs(q);

            if (querySnapshot.empty) {
                lista.innerHTML = "<li>No se encontró tu quiniela</li>";
            } else {
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    const resultados = data.resultados || [];
                    resultados.forEach((res, i) => {
                        const item = document.createElement("li");
                        item.textContent = `Partido ${i + 1}: ${res.local} - ${res.visitante}`;
                        lista.appendChild(item);
                    });
                });
            }
            document.getElementById("mi-quiniela").style.display = "block";
        };

        window.mostrarTablaParticipantes = async function () {
            const lista = document.getElementById("lista-participantes");
            lista.innerHTML = "";

            const querySnapshot = await getDocs(collection(db, "participantes"));
            querySnapshot.forEach(doc => {
                const data = doc.data();
                const puntos = data.puntos || 0;

                // Crear barra de progreso
                const progressBar = document.createElement("div");
                progressBar.className = "progress-bar";
                progressBar.style.width = `${(puntos / 8) * 100}%`;

                const item = document.createElement("li");
                item.innerHTML = `
                    <span>${data.nombre || "Sin nombre"} - ${puntos} puntos</span>
                    <div class="progress-container">
                        ${progressBar.outerHTML}
                    </div>
                `;
                lista.appendChild(item);
            });
        };

        // Cargar la tabla de participantes al cargar la página
        mostrarTablaParticipantes();
    </script>
</body>
</html>